"use strict";(self.webpackChunkarcgis=self.webpackChunkarcgis||[]).push([[7434],{67434:(v,E,r)=>{r.r(E),r.d(E,{default:()=>B});var h=r(15861),u=r(17626),c=(r(8314),r(62208)),O=(r(63290),r(90912),r(85931),r(26584),r(76898)),C=r(84682),I=r(36859),R=r(39351),L=r(13112),i=r(55376);class d{constructor(t,o){this.offset=t,this.extent=o}}let T=class extends L.Z{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}update(_,t){var o=this;return(0,h.Z)(function*(){const s=t.schema.processors[0];"heatmap"===s.type&&(0,C.Hg)(o._schema,s)&&(_.mesh=!0,o._schema=s)})()}onTileUpdate(_){for(const t of _.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(_){return this._tileKeyToFeatureSets.delete(_.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:_.id,data:{clear:!0}})}onTileMessage(_,t,o){var s=this;return(0,h.Z)(function*(){s._tileKeyToFeatureSets.has(_.key.id)||s._tileKeyToFeatureSets.set(_.key.id,new Map);const e=s._tileKeyToFeatureSets.get(_.key.id);if(e&&(0,c.pC)(t.addOrUpdate)&&t.addOrUpdate.hasFeatures&&e.set(t.addOrUpdate.instance,t),t.end){const a=[],U=function j(_){const t=_.key,o=new Map,s=256,e=R.I_,a=_.tileInfoView.tileInfo.isWrappable;return o.set((0,i.M)(t,-1,-1,a).id,new d([-e,-e],[e-s,e-s,e,e])),o.set((0,i.M)(t,0,-1,a).id,new d([0,-e],[0,e-s,e,e])),o.set((0,i.M)(t,1,-1,a).id,new d([e,-e],[0,e-s,s,e])),o.set((0,i.M)(t,-1,0,a).id,new d([-e,0],[e-s,0,e,e])),o.set((0,i.M)(t,1,0,a).id,new d([e,0],[0,0,s,e])),o.set((0,i.M)(t,-1,1,a).id,new d([-e,e],[e-s,0,e,s])),o.set((0,i.M)(t,0,1,a).id,new d([0,e],[0,0,e,s])),o.set((0,i.M)(t,1,1,a).id,new d([e,e],[0,0,s,s])),o}(_);s._tileKeyToFeatureSets.forEach((K,p)=>{if(p===_.key.id)K.forEach(D=>(0,c.yw)(D.addOrUpdate,P=>a.push(P)));else if(U.has(p)){const D=U.get(p),[P,g]=D.offset;K.forEach(w=>(0,c.yw)(w.addOrUpdate,S=>{const F=S.transform(P,g,1,1);a.push(F)}))}});const m=(0,I.QM)(a,s._schema.mesh,512,512);return s.remoteClient.invoke("tileRenderer.onTileData",{tileKey:_.key.id,intensityInfo:m},{...o,transferList:[m.matrix]})}})()}onTileError(_,t,o){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:_.id,error:t},o)}};T=(0,u._)([(0,O.j)("esri.views.2d.layers.features.processors.HeatmapProcessor")],T);const B=T},55376:(v,E,r)=>{function h(u,f,c,y){const n=u.clone(),M=1<<n.level,l=n.col+f,O=n.row+c;return y&&l<0?(n.col=l+M,n.world-=1):l>=M?(n.col=l-M,n.world+=1):n.col=l,n.row=O,n}r.d(E,{M:()=>h})}}]);