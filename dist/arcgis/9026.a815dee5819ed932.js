"use strict";(self.webpackChunkarcgis=self.webpackChunkarcgis||[]).push([[9026],{47123:(se,K,s)=>{s.d(K,{T:()=>S});var C=s(15861),p=s(10699),L=s(35133),N=s(28082),z=s(26268),G=s(62208),x=s(23841),M=s(16730),f=s(21254),v=s(87526),m=s(17807),Z=s(25575),c=s(31637);function H($,i){const d=i.length;if($<i[0].value||1===d)return i[0].size;for(let u=1;u<d;u++)if($<i[u].value)return i[u-1].size+($-i[u-1].value)/(i[u].value-i[u-1].value)*(i[u].size-i[u-1].size);return i[d-1].size}class J{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.outsideLabelsVisible=!1,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1},this._technique=m.v}getSizeVVFieldStops(i){const d=this._vvSizeFieldStops;if(d)switch(d.type){case"static":return d;case"level-dependent":return(0,G.Pt)(d.levels[i],()=>{let u=1/0,g=0;for(const b in d.levels){const O=parseFloat(b),T=Math.abs(i-O);T<u&&(u=T,g=O)}if(u===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const A=2**((i-g)/2),Q=(0,G.Wg)(d.levels[g]),D=new Float32Array(Q.values);return D[2]*=A,D[3]*=A,{sizes:(0,G.Wg)(Q.sizes),values:D}});default:return}}get vvMaterialParameters(){return this._vvMaterialParameters}update(i){(0,G.pC)(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,i)}setInfo(i,d,u){this._updateEffects(u),this._vvInfo=d,this._technique=(0,Z.EJ)(i),this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,i)}getVariation(){return{...this._technique.getVariation(this.rendererSchema),outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:(0,c.hc)("2d").supportsTextureFloat}}getVariationHash(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}_updateEffects(i){this.outsideLabelsVisible=!!(0,G.pC)(i)&&i.excludedLabelsVisible}_updateVisualVariables(i,d){const u=this._vvMaterialParameters;if(u.vvOpacityEnabled=!1,u.vvSizeEnabled=!1,u.vvColorEnabled=!1,u.vvRotationEnabled=!1,!i)return;const g=i.size;if(g){if(u.vvSizeEnabled=!0,g.minMaxValue){const b=g.minMaxValue;let O,T;if((0,v.$K)(b.minSize)&&(0,v.$K)(b.maxSize))if((0,v.hj)(b.minSize)&&(0,v.hj)(b.maxSize))O=(0,x.F2)(b.minSize),T=(0,x.F2)(b.maxSize);else{const V=d.scale;O=(0,x.F2)(H(V,b.minSize.stops)),T=(0,x.F2)(H(V,b.maxSize.stops))}this.vvSizeMinMaxValue.set([b.minDataValue,b.maxDataValue,O,T])}if(g.scaleStops&&(this.vvSizeScaleStopsValue=(0,x.F2)(H(d.scale,g.scaleStops.stops))),g.unitValue){const b=(0,M.c9)(d.spatialReference)/f.a[g.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=b/d.resolution}g.fieldStops&&(this._vvSizeFieldStops=g.fieldStops)}const A=i.color;A&&(u.vvColorEnabled=!0,this.vvColorValues.set(A.values),this.vvColors.set(A.colors));const Q=i.opacity;Q&&(u.vvOpacityEnabled=!0,this.vvOpacityValues.set(Q.values),this.vvOpacities.set(Q.opacities));const D=i.rotation;D&&(u.vvRotationEnabled=!0,u.vvRotationType=D.type)}}class S extends z.Z{constructor(i){super(i),this._rendererInfo=new J,this._materialItemsRequestQueue=new L.Z,this.attributeView=new N.H(()=>this.onAttributeStoreUpdate())}destroy(){this.children.forEach(i=>i.destroy()),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(i,d,u){this._rendererInfo.setInfo(i,d,u),this.requestRender()}getMaterialItems(i,d){var u=this;return(0,C.Z)(function*(){if(!i||0===i.length)return[];const g=(0,p.hh)();return u._materialItemsRequestQueue.push({items:i,abortOptions:d,resolver:g}),u.requestRender(),g.promise})()}doRender(i){if(i.context.capabilities.enable("textureFloat"),i.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0){let d=this._materialItemsRequestQueue.pop();for(;d;)this._processMaterialItemRequest(i,d),d=this._materialItemsRequestQueue.pop()}super.doRender(i)}renderChildren(i){for(const d of this.children)d.commit(i);this._rendererInfo.update(i.state),super.renderChildren(i)}updateTransforms(i){if(this.children.some(d=>d.hasData))for(const d of this.children)d.setTransform(i)}createRenderParams(i){const d=super.createRenderParams(i);return d.rendererInfo=this._rendererInfo,d.attributeView=this.attributeView,d}onAttributeStoreUpdate(){}_processMaterialItemRequest(i,{items:d,abortOptions:u,resolver:g}){const{painter:A,pixelRatio:Q}=i,D=d.map(b=>A.textureManager.rasterizeItem(b.symbol,Q,b.glyphIds,u));Promise.all(D).then(b=>{if(!this.stage)return void g.reject();const O=b.map((T,V)=>({id:d[V].id,mosaicItem:T}));g.resolve(O)},g.reject)}}},26268:(se,K,s)=>{s.d(K,{Z:()=>x});var C=s(8314),p=s(39406),L=s(44589),N=s(8650),z=s(13382);const G=(M,f)=>M.key.level-f.key.level!=0?M.key.level-f.key.level:M.key.row-f.key.row!=0?M.key.row-f.key.row:M.key.col-f.key.col;class x extends L.Z{constructor(f){super(),this._tileInfoView=f}get requiresDedicatedFBO(){return!1}renderChildren(f){this.sortChildren(G),this.setStencilReference(f),super.renderChildren(f)}createRenderParams(f){const{state:v}=f,m=super.createRenderParams(f);return m.requiredLevel=this._tileInfoView.getClosestInfoForScale(v.scale).level,m.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(v.scale),m}prepareRenderPasses(f){const v=super.prepareRenderPasses(f);return v.push(f.registerRenderPass({name:"stencil",brushes:[z.Z],drawPhase:p.jx.DEBUG|p.jx.MAP|p.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,C.Z)("esri-tiles-debug")&&v.push(f.registerRenderPass({name:"tileInfo",brushes:[N.Z],drawPhase:p.jx.DEBUG,target:()=>this.children})),v}getStencilTarget(){return this.children}setStencilReference(f){let v=1;for(const m of this.children)m.stencilRef=v++}}},55051:(se,K,s)=>{s.d(K,{Z:()=>$});var C=s(62208),p=s(47123),L=s(30217),N=s(49966),z=s(9545),G=s(14658),x=s(93555),M=s(57477),f=s(87526),v=s(83994),m=s(67969),Z=s(49353);const c=Math.PI/180;class J extends M.s{constructor(d){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,N.c)(),this._localOrigin={x:0,y:0},this._getBounds=d}destroy(){this._vao&&(this._vao.dispose(!0),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,C.M2)(this._program)}doRender(d){const{context:u}=d,g=this._getBounds();if(g.length<1)return;this._createShaderProgram(u),this._updateMatricesAndLocalOrigin(d),this._updateBufferData(u,g),u.setBlendingEnabled(!0),u.setDepthTestEnabled(!1),u.setStencilWriteMask(0),u.setStencilTestEnabled(!1),u.setBlendFunction(m.zi.ONE,m.zi.ONE_MINUS_SRC_ALPHA),u.setColorMask(!0,!0,!0,!0);const A=this._program;u.bindVAO(this._vao),u.useProgram(A),A.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),u.gl.lineWidth(1),u.drawElements(m.MX.LINES,8*g.length,m.g.UNSIGNED_INT,0),u.bindVAO()}_createTransforms(){return{dvs:(0,N.c)()}}_createShaderProgram(d){this._program||(this._program=d.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",S().attributes))}_updateMatricesAndLocalOrigin(d){const{state:u}=d,{displayMat3:g,size:A,resolution:Q,pixelRatio:D,rotation:b,viewpoint:O}=u,T=c*b,{x:V,y:le}=O.targetGeometry,ue=(0,x.or)(V,u.spatialReference);this._localOrigin.x=ue,this._localOrigin.y=le;const ae=D*A[0],oe=D*A[1],de=Q*ae,he=Q*oe,q=(0,L.g)(this._dvsMat3);(0,L.m)(q,q,g),(0,L.h)(q,q,(0,z.f)(ae/2,oe/2)),(0,L.d)(q,q,(0,G.f)(A[0]/de,-oe/he,1)),(0,L.r)(q,q,-T)}_updateBufferData(d,u){const{x:g,y:A}=this._localOrigin,D=new Float32Array(8*u.length),b=new Uint32Array(8*u.length);let O=0,T=0;for(const V of u)V&&(D[2*O+0]=V[0]-g,D[2*O+1]=V[1]-A,D[2*O+2]=V[0]-g,D[2*O+3]=V[3]-A,D[2*O+4]=V[2]-g,D[2*O+5]=V[3]-A,D[2*O+6]=V[2]-g,D[2*O+7]=V[1]-A,b[T+0]=O+0,b[T+1]=O+3,b[T+2]=O+3,b[T+3]=O+2,b[T+4]=O+2,b[T+5]=O+1,b[T+6]=O+1,b[T+7]=O+0,O+=4,T+=8);if(this._vertexBuffer?this._vertexBuffer.setData(D.buffer):this._vertexBuffer=v.f.createVertex(d,m.l1.DYNAMIC_DRAW,D.buffer),this._indexBuffer?this._indexBuffer.setData(b):this._indexBuffer=v.f.createIndex(d,m.l1.DYNAMIC_DRAW,b),!this._vao){const V=S();this._vao=new Z.U(d,V.attributes,V.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const S=()=>(0,f.cM)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:m.g.FLOAT}]});let $=class extends p.T{constructor(i){super(i),this.hasHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,C.SC)(this._boundsRenderer)}enableRenderingBounds(i){this._boundsRenderer=new J(i),this.requestRender()}get hasLabels(){return!1}onTileData(i,d){i.patch(d),this.contains(i)||this.addChild(i),this.requestRender()}onTileError(i){i.clear(),this.contains(i)||this.addChild(i)}_renderChildren(i,d){for(const u of this.children)u.isReady&&u.hasData&&(u.commit(i),i.context.setStencilFunction(m.wb.EQUAL,u.stencilRef,255),u.getDisplayList().replay(i,u,d))}}},13305:(se,K,s)=>{s.d(K,{Z:()=>Z});var C=s(17626),x=(s(63290),s(90912),s(85931),s(26584),s(8314),s(76898)),M=s(39406),f=s(55051),v=s(67969);let m=class extends f.Z{doRender(c){c.drawPhase===M.jx.HIGHLIGHT&&super.doRender(c)}renderChildren(c){if(this.attributeView.update(),!this.children.some(S=>S.hasData))return;this.attributeView.bindTextures(c.context),super.renderChildren(c);const{painter:H}=c,J=H.effects.highlight;J.bind(c),c.context.setColorMask(!0,!0,!0,!0),c.context.clear(v.lk.COLOR_BUFFER_BIT),this._renderChildren(c,J.defines.concat(["highlightAll"])),J.draw(c),J.unbind()}};m=(0,C._)([(0,x.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],m);const Z=m},94421:(se,K,s)=>{s.d(K,{Z:()=>f});var C=s(17626),p=s(63290),L=s(10699),N=s(32917),z=s(77712),M=(s(90912),s(85931),s(76898));const f=v=>{let m=class extends v{initialize(){this.handles.add((0,N.on)(()=>this.layer,"refresh",Z=>{this.doRefresh(Z.dataChanged).catch(c=>{(0,L.D_)(c)||p.Z.getLogger(this.declaredClass).error(c)})}),"RefreshableLayerView")}};return(0,C._)([(0,z.Cb)()],m.prototype,"layer",void 0),m=(0,C._)([(0,M.j)("esri.layers.mixins.RefreshableLayerView")],m),m}},84537:(se,K,s)=>{s.d(K,{VF:()=>te,Uf:()=>Ae});var C=s(15861),p=s(17626),L=s(88879),N=s(14517),z=s(74333),G=s(26584),x=s(8314),M=s(88159),f=s(62208),v=s(10699),m=s(32917),Z=s(16730),c=s(77712),H=s(90912),S=(s(85931),s(76898)),$=s(2004),i=s(83137),d=s(59990);function u(r,e){return e?"xoffset"in e&&e.xoffset?Math.max(r,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(r,Math.abs(e.yoffset||0)):r:r}function A(r,e){return"number"==typeof r?r:r&&r.stops&&r.stops.length?function g(r){let e=0,a=0;for(let l=0;l<r.length;l++){const o=r[l].size;"number"==typeof o&&(e+=o,a++)}return e/a}(r.stops):e}function D(r){const e=r&&r.renderer,a="touch"===(r&&r.event&&r.event.pointerType)?9:6;if(!e)return a;const l="visualVariables"in e?function Q(r,e){if(!e)return r;const a=e.filter(E=>"size"===E.type).map(E=>{const{maxSize:F,minSize:y}=E;return(A(F,r)+A(y,r))/2});let l=0;const o=a.length;if(0===o)return r;for(let E=0;E<o;E++)l+=a[E];const h=Math.floor(l/o);return Math.max(h,r)}(a,e.visualVariables):a;if("simple"===e.type)return u(l,e.symbol);if("unique-value"===e.type){let o=l;return e.uniqueValueInfos?.forEach(h=>{o=u(o,h.symbol)}),o}if("class-breaks"===e.type){let o=l;return e.classBreakInfos.forEach(h=>{o=u(o,h.symbol)}),o}return l}var b=s(84792),O=s(93555),T=s(2618),V=s(95737),le=s(91179),ue=s(13410);const ae=r=>r.spatialReference.wkid||JSON.stringify(r.spatialReference);var ce,q=s(29132),Me=s(97478),ve=s(86810),Re=s(65234);let j=ce=class extends ve.wq{static from(r){return(0,H.TJ)(ce,r)}constructor(r){super(r),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}};(0,p._)([(0,c.Cb)({type:Number,json:{write:!0}})],j.prototype,"dpi",void 0),(0,p._)([(0,c.Cb)()],j.prototype,"floors",void 0),(0,p._)([(0,c.Cb)({type:String,json:{write:!0}})],j.prototype,"gdbVersion",void 0),(0,p._)([(0,c.Cb)({types:q.qM,json:{read:le.im,write:!0}})],j.prototype,"geometry",void 0),(0,p._)([(0,c.Cb)({type:Number,json:{write:!0}})],j.prototype,"geometryPrecision",void 0),(0,p._)([(0,c.Cb)({type:Number,json:{write:!0}})],j.prototype,"height",void 0),(0,p._)([(0,c.Cb)({type:[Number],json:{write:!0}})],j.prototype,"layerIds",void 0),(0,p._)([(0,c.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],j.prototype,"layerOption",void 0),(0,p._)([(0,c.Cb)({type:$.Z,json:{write:!0}})],j.prototype,"mapExtent",void 0),(0,p._)([(0,c.Cb)({type:Number,json:{write:!0}})],j.prototype,"maxAllowableOffset",void 0),(0,p._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],j.prototype,"returnFieldName",void 0),(0,p._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],j.prototype,"returnGeometry",void 0),(0,p._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],j.prototype,"returnM",void 0),(0,p._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],j.prototype,"returnUnformattedValues",void 0),(0,p._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],j.prototype,"returnZ",void 0),(0,p._)([(0,c.Cb)({type:Re.Z,json:{write:!0}})],j.prototype,"spatialReference",void 0),(0,p._)([(0,c.Cb)()],j.prototype,"sublayers",void 0),(0,p._)([(0,c.Cb)({type:Me.Z,json:{write:!0}})],j.prototype,"timeExtent",void 0),(0,p._)([(0,c.Cb)({type:Number,json:{write:!0}})],j.prototype,"tolerance",void 0),(0,p._)([(0,c.Cb)({type:Number,json:{write:!0}})],j.prototype,"width",void 0),j=ce=(0,p._)([(0,S.j)("esri.rest.support.IdentifyParameters")],j);const ge=j;var Oe=s(68653),_e=s(99433),Pe=s(71774);let ee=class extends ve.wq{constructor(r){super(r),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(r,e){return L.Z.fromJSON({attributes:{...e.attributes},geometry:{...e.geometry}})}writeFeature(r,e){if(!r)return;const{attributes:a,geometry:l}=r;a&&(e.attributes={...a}),(0,f.pC)(l)&&(e.geometry=l.toJSON(),e.geometryType=Pe.P.toJSON(l.type))}};(0,p._)([(0,c.Cb)({type:String,json:{write:!0}})],ee.prototype,"displayFieldName",void 0),(0,p._)([(0,c.Cb)({type:L.Z})],ee.prototype,"feature",void 0),(0,p._)([(0,Oe.r)("feature",["attributes","geometry"])],ee.prototype,"readFeature",null),(0,p._)([(0,_e.c)("feature")],ee.prototype,"writeFeature",null),(0,p._)([(0,c.Cb)({type:Number,json:{write:!0}})],ee.prototype,"layerId",void 0),(0,p._)([(0,c.Cb)({type:String,json:{write:!0}})],ee.prototype,"layerName",void 0),ee=(0,p._)([(0,S.j)("esri.rest.support.IdentifyResult")],ee);const Ce=ee;function pe(){return(pe=(0,C.Z)(function*(r,e,a){const l=(e=function De(r){return ge.from(r)}(e)).geometry?[e.geometry]:[],o=(0,T.en)(r);return o.path+="/identify",(0,O.aX)(l).then(h=>{const E=function oe(r,e){const{dpi:a,gdbVersion:l,geometry:o,geometryPrecision:h,height:E,layerOption:F,mapExtent:y,maxAllowableOffset:P,returnFieldName:_,returnGeometry:R,returnUnformattedValues:I,returnZ:B,spatialReference:U,timeExtent:X,tolerance:W,width:w}=r.toJSON(),{dynamicLayers:k,layerDefs:re,layerIds:ne}=function de(r){const{mapExtent:e,floors:a,width:l,sublayers:o,layerIds:h,layerOption:E,gdbVersion:F}=r,y=o?.find(U=>null!=U.layer)?.layer?.serviceSublayers,P="popup"===E,_={},R=(0,i.yZ)({extent:e,width:l,spatialReference:e?.spatialReference}),I=[],B=U=>{if(U.visible&&(0===R||(0===U.minScale||R<=U.minScale)&&(0===U.maxScale||R>=U.maxScale)))if(U.sublayers)U.sublayers.forEach(B);else{if(!1===h?.includes(U.id)||P&&(!U.popupTemplate||!U.popupEnabled))return;I.unshift(U)}};if(o?.forEach(B),o&&!I.length)_.layerIds=[];else{const U=(0,ue.FN)(I,y,F),X=I.map(W=>{const w=(0,d.f)(a,W);return W.toExportImageJSON(w)});if(U)_.dynamicLayers=JSON.stringify(X);else{if(o){let w=I.map(({id:k})=>k);h&&(w=w.filter(k=>h.includes(k))),_.layerIds=w}else h?.length&&(_.layerIds=h);const W=function he(r,e){const a=!!r?.length,l=e.filter(o=>null!=o.definitionExpression||a&&null!=o.floorInfo);return l.length?l.map(o=>{const h=(0,d.f)(r,o),E=(0,V._)(h,o.definitionExpression);return{id:o.id,definitionExpression:(0,f.Pt)(E,void 0)}}):null}(a,I);if((0,f.pC)(W)&&W.length){const w={};for(const k of W)k.definitionExpression&&(w[k.id]=k.definitionExpression);Object.keys(w).length&&(_.layerDefs=JSON.stringify(w))}}}return _}(r),xe=e&&(0,f.pC)(e.geometry)?e.geometry:null,Y={geometryPrecision:h,maxAllowableOffset:P,returnFieldName:_,returnGeometry:R,returnUnformattedValues:I,returnZ:B,tolerance:W},ie=xe&&xe.toJSON()||o;if(Y.imageDisplay=`${w},${E},${a}`,l&&(Y.gdbVersion=l),ie&&(delete ie.spatialReference,Y.geometry=JSON.stringify(ie),Y.geometryType=(0,le.Ji)(ie)),U?Y.sr=U.wkid||JSON.stringify(U):ie&&ie.spatialReference?Y.sr=ae(ie):y&&y.spatialReference&&(Y.sr=ae(y)),Y.time=X?[X.start,X.end].join(","):null,y){const{xmin:Be,ymin:Ze,xmax:we,ymax:ze}=y;Y.mapExtent=`${Be},${Ze},${we},${ze}`}return re&&(Y.layerDefs=re),k&&!re&&(Y.dynamicLayers=k),Y.layers="popup"===F?"visible":F,ne&&!k&&(Y.layers+=`:${ne.join(",")}`),Y}(e,{geometry:h&&h[0]}),F=(0,T.cv)({...o.query,f:"json",...E}),y=(0,T.lA)(F,a);return(0,b.default)(o.path,y).then(Se).then(P=>function Te(r,e){if(!e?.length)return r;const a=new Map;e.forEach(function l(o){a.set(o.id,o),o.sublayers&&o.sublayers.forEach(l)});for(const o of r.results)o.feature.sourceLayer=a.get(o.layerId);return r}(P,e.sublayers))})})).apply(this,arguments)}function Se(r){const e=r.data;return e.results=e.results||[],e.exceededTransferLimit=Boolean(e.exceededTransferLimit),e.results=e.results.map(a=>Ce.fromJSON(a)),e}var Ue=s(46679),Ee=s(57213),be=s(10023);let fe=null;function Ae(r,e){return"tile"===e.type||"map-image"===e.type}let te=class extends N.Z{constructor(r){var e;super(r),e=this,this._featuresResolutions=new WeakMap,this.highlightGraphics=null,this.highlightGraphicUpdated=null,this.updateHighlightedFeatures=(0,v.Ds)(function(){var a=(0,C.Z)(function*(l){e.destroyed||e.updatingHandles.addPromise(e._updateHighlightedFeaturesGeometries(l).catch(()=>{}))});return function(l){return a.apply(this,arguments)}}())}initialize(){const r=e=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(e).catch(()=>{})),this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([(0,m.on)(()=>this.highlightGraphics,"change",e=>r(e.added),{onListenerAdd:e=>r(e)})])}fetchPopupFeatures(r,e){var a=this;return(0,C.Z)(function*(){const{layerView:{layer:l,view:{scale:o}}}=a;if(!r)throw new G.Z("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:l});const h=function je(r,e,a){const l=[],o=h=>{if(h.visible&&(0===h.minScale||e<=h.minScale)&&(0===h.maxScale||e>=h.maxScale))if(h.sublayers)h.sublayers.forEach(o);else if(h.popupEnabled){const y=(0,be.V)(h,{...a,defaultPopupTemplateEnabled:!1});(0,f.pC)(y)&&l.unshift({sublayer:h,popupTemplate:y})}};return(r?.toArray()??[]).reverse().map(o),l}(l.sublayers,o,e);if(!h.length)return[];const E=yield function Ve(r,e){return ye.apply(this,arguments)}(l,h);if(!((l.capabilities?.operations?.supportsIdentify??1)&&l.version>=10.5||E))throw new G.Z("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:l});return E?a._fetchPopupFeaturesUsingQueries(r,h,e):a._fetchPopupFeaturesUsingIdentify(r,h,e)})()}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(r){const e=this.highlightGraphics;if(!e)return{remove(){}};let a=null;if(r instanceof L.Z?a=[r]:z.Z.isCollection(r)&&r.length>0?a=r.toArray():Array.isArray(r)&&r.length>0&&(a=r),a=a?.filter(f.pC),!a||!a.length)return{remove:()=>{}};for(const l of a){const o=l.sourceLayer;null!=o&&"geometryType"in o&&"point"===o.geometryType&&(l.visible=!1)}return e.addMany(a),{remove:()=>{e.removeMany(a??[])}}}_updateHighlightedFeaturesSymbols(r){var e=this;return(0,C.Z)(function*(){const{layerView:{view:a},highlightGraphics:l,highlightGraphicUpdated:o}=e;if(l&&o)for(const h of r){const E=h.sourceLayer&&"renderer"in h.sourceLayer&&h.sourceLayer.renderer;h.sourceLayer&&"geometryType"in h.sourceLayer&&"point"===h.sourceLayer.geometryType&&E&&"getSymbolAsync"in E&&E.getSymbolAsync(h).then(function(){var F=(0,C.Z)(function*(y){y||(y=new Ee.Z);let P=null;const _="visualVariables"in E?E.visualVariables?.find(R=>"size"===R.type):void 0;_&&(fe||(fe=(yield Promise.resolve().then(s.bind(s,81808))).getSize),P=fe(_,h,{view:a.type,scale:a.scale,shape:"simple-marker"===y.type?y.style:null})),P||(P="width"in y&&"height"in y&&null!=y.width&&null!=y.height?Math.max(y.width,y.height):"size"in y?y.size:16),l.includes(h)&&(h.symbol=new Ee.Z({style:"square",size:P,xoffset:"xoffset"in y?y.xoffset:0,yoffset:"yoffset"in y?y.yoffset:0}),o(h,"symbol"),h.visible=!0)});return function(y){return F.apply(this,arguments)}}())}})()}_updateHighlightedFeaturesGeometries(r){var e=this;return(0,C.Z)(function*(){const{layerView:{layer:a,view:l},highlightGraphics:o,highlightGraphicUpdated:h}=e;if(e._highlightGeometriesResolution=r,!h||!o?.length||!a.capabilities.operations.supportsQuery)return;const E=e._getTargetResolution(r),F=new Map;for(const _ of o)(!e._featuresResolutions.has(_)||e._featuresResolutions.get(_)>E)&&(0,M.s1)(F,_.sourceLayer,()=>new Map).set(_.getObjectId(),_);const y=Array.from(F,([_,R])=>{const I=_.createQuery();return I.objectIds=[...R.keys()],I.outFields=[_.objectIdField],I.returnGeometry=!0,I.maxAllowableOffset=E,I.outSpatialReference=l.spatialReference,_.queryFeatures(I)}),P=yield Promise.all(y);if(!e.destroyed)for(const{features:_}of P)for(const R of _){const B=F.get(R.sourceLayer).get(R.getObjectId());B&&o.includes(B)&&(B.geometry=R.geometry,h(B,"geometry"),e._featuresResolutions.set(B,E))}})()}_getTargetResolution(r){const e=r*(0,Z.c9)(this.layerView.view.spatialReference),a=e/16;return a<=10?0:r/e*a}_fetchPopupFeaturesUsingIdentify(r,e,a){var l=this;return(0,C.Z)(function*(){const o=yield l._createIdentifyParameters(r,e,a);if((0,f.Wi)(o))return[];const{results:h}=yield function Ie(r,e,a){return pe.apply(this,arguments)}(l.layerView.layer.parsedUrl,o);return h.map(E=>E.feature)})()}_createIdentifyParameters(r,e,a){var l=this;return(0,C.Z)(function*(){const{floors:o,layer:h,timeExtent:E,view:{spatialReference:F,scale:y}}=l.layerView,P=(0,f.pC)(a)?a.event:null;if(!e.length)return null;yield Promise.all(e.map(({sublayer:X})=>X.load().catch(()=>{})));const _=Math.min((0,x.Z)("mapservice-popup-identify-max-tolerance"),h.allSublayers.reduce((X,W)=>W.renderer?D({renderer:W.renderer,event:P}):X,2)),R=l.createFetchPopupFeaturesQueryGeometry(r,_),I=(0,i.dp)(y,F),B=Math.round(R.width/I),U=new $.Z({xmin:R.center.x-I*B,ymin:R.center.y-I*B,xmax:R.center.x+I*B,ymax:R.center.y+I*B,spatialReference:R.spatialReference});return new ge({floors:o,gdbVersion:"gdbVersion"in h?h.gdbVersion:void 0,geometry:r,height:B,layerOption:"popup",mapExtent:U,returnGeometry:!0,spatialReference:F,sublayers:h.sublayers,timeExtent:E,tolerance:_,width:B})})()}_fetchPopupFeaturesUsingQueries(r,e,a){var l=this;return(0,C.Z)(function*(){const{layerView:{floors:o,timeExtent:h}}=l,E=(0,f.pC)(a)?a.event:null,F=e.map(function(){var y=(0,C.Z)(function*({sublayer:P,popupTemplate:_}){if(yield P.load().catch(()=>{}),P.capabilities&&!P.capabilities.operations.supportsQuery)return[];const R=P.createQuery(),I=D({renderer:P.renderer,event:E}),B=l.createFetchPopupFeaturesQueryGeometry(r,I);if(R.geometry=B,R.outFields=yield(0,be.e)(P,_),R.timeExtent=h,o){const re=o.clone(),ne=(0,d.f)(re,P);(0,f.pC)(ne)&&(R.where=R.where?`(${R.where}) AND (${ne})`:ne)}const U=l._getTargetResolution(B.width/I),X=yield function Le(r){return r.expressionInfos?.length||Array.isArray(r.content)&&r.content.some(e=>"expression"===e.type)?(0,Ue.LC)():Promise.resolve()}(_),W="point"===P.geometryType||X&&X.arcadeUtils.hasGeometryOperations(_);W||(R.maxAllowableOffset=U);let{features:w}=yield P.queryFeatures(R);const k=W?0:U;w=yield function Fe(r,e){return me.apply(this,arguments)}(P,w);for(const re of w)l._featuresResolutions.set(re,k);return w});return function(P){return y.apply(this,arguments)}}());return(yield(0,v.as)(F)).reverse().reduce((y,P)=>P.value?[...y,...P.value]:y,[]).filter(y=>null!=y)})()}};function ye(){return(ye=(0,C.Z)(function*(r,e){if(r.capabilities?.operations?.supportsQuery)return!0;try{return yield Promise.any(e.map(({sublayer:a})=>a.load().then(()=>a.capabilities.operations.supportsQuery)))}catch{return!1}})).apply(this,arguments)}function me(){return(me=(0,C.Z)(function*(r,e){const a=r.renderer;return a&&"defaultSymbol"in a&&!a.defaultSymbol&&(e=a.valueExpression?yield Promise.all(e.map(l=>a.getSymbolAsync(l).then(o=>o?l:null))).then(l=>l.filter(o=>null!=o)):e.filter(l=>null!=a.getSymbol(l))),e})).apply(this,arguments)}(0,p._)([(0,c.Cb)({constructOnly:!0})],te.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,p._)([(0,c.Cb)({constructOnly:!0})],te.prototype,"layerView",void 0),(0,p._)([(0,c.Cb)({constructOnly:!0})],te.prototype,"highlightGraphics",void 0),(0,p._)([(0,c.Cb)({constructOnly:!0})],te.prototype,"highlightGraphicUpdated",void 0),(0,p._)([(0,c.Cb)({constructOnly:!0})],te.prototype,"updatingHandles",void 0),te=(0,p._)([(0,S.j)("esri.views.layers.support.MapService")],te)},10023:(se,K,s)=>{s.d(K,{V:()=>G,e:()=>N});var C=s(15861),p=s(62208),L=s(36630);function N(x){return z.apply(this,arguments)}function z(){return(z=(0,C.Z)(function*(x,M=x.popupTemplate){if((0,p.Wi)(M))return[];const f=yield M.getRequiredFields(x.fieldsIndex),{lastEditInfoEnabled:v}=M,{objectIdField:m,typeIdField:Z,globalIdField:c,relationships:H}=x;if(f.includes("*"))return["*"];const J=v?yield(0,L.CH)(x):[],S=(0,L.Q0)(x.fieldsIndex,[...f,...J]);return Z&&S.push(Z),S&&m&&x.fieldsIndex?.has(m)&&!S.includes(m)&&S.push(m),S&&c&&x.fieldsIndex?.has(c)&&!S.includes(c)&&S.push(c),H&&H.forEach($=>{const{keyField:i}=$;S&&i&&x.fieldsIndex?.has(i)&&!S.includes(i)&&S.push(i)}),S})).apply(this,arguments)}function G(x,M){return x.popupTemplate?x.popupTemplate:(0,p.pC)(M)&&M.defaultPopupTemplateEnabled&&(0,p.pC)(x.defaultPopupTemplate)?x.defaultPopupTemplate:null}},94672:(se,K,s)=>{s.d(K,{K:()=>z}),s(29132);var p=s(62208),L=s(16730),N=s(2004);function z(M,f,v,m=new N.Z){let Z=0;if("2d"===v.type)Z=f*(v.resolution??0);else if("3d"===v.type){const i=v.overlayPixelSizeInMapUnits(M),d=v.basemapSpatialReference;Z=(0,p.pC)(d)&&!d.equals(v.spatialReference)?(0,L.c9)(d)/(0,L.c9)(v.spatialReference):f*i}const c=M.x-Z,H=M.y-Z,J=M.x+Z,S=M.y+Z,{spatialReference:$}=v;return m.xmin=Math.min(c,J),m.ymin=Math.min(H,S),m.xmax=Math.max(c,J),m.ymax=Math.max(H,S),m.spatialReference=$,m}new N.Z}}]);