"use strict";(self.webpackChunkarcgis=self.webpackChunkarcgis||[]).push([[289],{70289:(ce,g,t)=>{t.r(g),t.d(g,{default:()=>ae});var f,I=t(15861),o=t(17626),F=(t(29132),t(73281)),U=(t(4832),t(49067),t(96794),t(69747),t(40425),t(69357),t(40342)),Z=t(73640),L=t(33474),b=t(32088),O=t(84792),D=t(20383),y=t(26584),E=t(54024),N=t(63290),A=t(62208),M=t(99959),w=t(10699),n=t(77712),S=t(90912),C=(t(85931),t(68653)),R=t(76898),J=t(383),v=t(71774),G=t(44917),z=t(65088),Q=t(552),V=t(50107),Y=t(35126),$=t(15008),W=t(49286),B=t(6647),H=t(30346),K=t(99555),X=t(97941),d=t(13812),k=t(36255),q=t(55911),c=t(36630),_=t(170),ee=t(62667),te=t(86810);let p=f=class extends te.wq{constructor(){super(...arguments),this.age=null,this.ageReceived=null,this.displayCount=null,this.maxObservations=1}clone(){return new f({age:this.age,ageReceived:this.ageReceived,displayCount:this.displayCount,maxObservations:this.maxObservations})}};(0,o._)([(0,n.Cb)({type:Number,json:{write:!0}})],p.prototype,"age",void 0),(0,o._)([(0,n.Cb)({type:Number,json:{write:!0}})],p.prototype,"ageReceived",void 0),(0,o._)([(0,n.Cb)({type:Number,json:{write:!0}})],p.prototype,"displayCount",void 0),(0,o._)([(0,n.Cb)({type:Number,json:{write:!0}})],p.prototype,"maxObservations",void 0),p=f=(0,o._)([(0,R.j)("esri.layers.support.PurgeOptions")],p);const x=p;var re=t(39683),oe=t(96854),ne=t(49430),ie=t(82706),T=t(65234),se=t(2004);const j=(0,q.v)();function P(r,e){return new y.Z("layer:unsupported",`Layer (${r.title}, ${r.id}) of type '${r.declaredClass}' ${e}`,{layer:r})}let i=class extends((0,$.M)((0,Y.b)((0,Q.h)((0,X.n)((0,K.M)((0,H.Q)((0,z.Y)((0,W.q)((0,B.I)((0,M.R)((0,V.N)(G.Z)))))))))))){constructor(...r){super(...r),this.copyright=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.geometryDefinition=null,this.geometryType=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.maxReconnectionAttempts=0,this.maxReconnectionInterval=20,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.operationalLayerType="ArcGISStreamLayer",this.popupEnabled=!0,this.popupTemplate=null,this.purgeOptions=new x,this.screenSizePerspectiveEnabled=!0,this.sourceJSON=null,this.spatialReference=T.Z.WGS84,this.type="stream",this.url=null,this.updateInterval=300,this.webSocketUrl=null}normalizeCtorArgs(r,e){return"string"==typeof r?{url:r,...e}:r}load(r){if(!("WebSocket"in globalThis))return this.addResolvingPromise(Promise.reject(new y.Z("stream-layer:websocket-unsupported","WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."))),Promise.resolve(this);const e=(0,A.pC)(r)?r.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service","Feed"]},r).catch(w.r9).then(()=>this._fetchService(e))),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(r){(0,c.YN)(r,this.fieldsIndex),this._set("renderer",r)}readRenderer(r,e,s){const a=(e=e.layerDefinition||e).drawingInfo&&e.drawingInfo.renderer||void 0;if(a){const l=(0,L.a)(a,e,s)||void 0;return l||N.Z.getLogger(this.declaredClass).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:s}),l}if(e.defaultSymbol)return e.types&&e.types.length?new Z.Z({defaultSymbol:u(e.defaultSymbol,e,s),field:e.typeIdField,uniqueValueInfos:e.types.map(l=>({id:l.id,symbol:u(l.symbol,l,s)}))}):new U.Z({symbol:u(e.defaultSymbol,e,s)})}connect(r){var e=this;return(0,I.Z)(function*(){const[{createConnection:s}]=yield Promise.all([t.e(8592).then(t.bind(t,20901)),e.load()]),a=e.geometryType?v.M.toJSON(e.geometryType):null,{customParameters:l=null,definitionExpression:le=null,geometryDefinition:de=null,maxReconnectionAttempts:pe=0,maxReconnectionInterval:ye=20,spatialReference:me=e.spatialReference}=r||e.createConnectionParameters(),m=s(e.parsedUrl,e.spatialReference,me,a,{geometry:de,where:le},pe,ye,l??void 0),ve=(0,E.AL)([e.on("send-message-to-socket",h=>m.sendMessageToSocket(h)),e.on("send-message-to-client",h=>m.sendMessageToClient(h))]);return m.once("destroy",ve.remove),m})()}createConnectionParameters(){return{spatialReference:this.spatialReference,customParameters:this.customParameters,definitionExpression:this.definitionExpression,geometryDefinition:this.geometryDefinition,maxReconnectionAttempts:this.maxReconnectionAttempts,maxReconnectionInterval:this.maxReconnectionInterval}}createPopupTemplate(r){return(0,ne.eZ)(this,r)}createQuery(){const r=new oe.Z;return r.returnGeometry=!0,r.outFields=["*"],r.where=this.definitionExpression||"1=1",r}getFieldDomain(r,e){if(!this.fields)return null;let s=null;return this.fields.some(a=>(a.name===r&&(s=a.domain),!!s)),s}getField(r){return this.fieldsIndex.get(r)}serviceSupportsSpatialReference(r){return!0}sendMessageToSocket(r){this.emit("send-message-to-socket",r)}sendMessageToClient(r){this.emit("send-message-to-client",r)}write(r,e){const s=e?.messages;return this.webSocketUrl?(s?.push(P(this,"using a custom websocket connection cannot be written to web scenes and web maps")),null):this.parsedUrl?super.write(r,e):(s?.push(P(this,"using a client-side only connection without a url cannot be written to web scenes and web maps")),null)}_fetchService(r){var e=this;return(0,I.Z)(function*(){if(!e.webSocketUrl&&e.parsedUrl){if(!e.sourceJSON){const{data:s}=yield(0,O.default)(e.parsedUrl.path,{query:{f:"json",...e.customParameters,...e.parsedUrl.query},responseType:"json",signal:r});e.sourceJSON=s}}else{if(!e.timeInfo?.trackIdField)throw new y.Z("stream-layer:missing-metadata","The stream layer trackIdField must be specified.");if(!e.objectIdField){const s=e.fields.find(a=>"oid"===a.type)?.name;if(!s)throw new y.Z("stream-layer:missing-metadata","The stream layer objectIdField must be specified.");e.objectIdField=s}if(!e.fields)throw new y.Z("stream-layer:missing-metadata","The stream layer fields must be specified.");if(e.fields.some(s=>s.name===e.objectIdField)||e.fields.push(new k.Z({name:e.objectIdField,alias:e.objectIdField,type:"oid"})),!e.geometryType)throw new y.Z("stream-layer:missing-metadata","The stream layer geometryType must be specified.");e.webSocketUrl&&(e.url=e.webSocketUrl)}return e.read(e.sourceJSON,{origin:"service",portalItem:e.portalItem,portal:e.portalItem?.portal,url:e.parsedUrl}),(0,c.YN)(e.renderer,e.fieldsIndex),(0,c.UF)(e.timeInfo,e.fieldsIndex),e.objectIdField||(e.objectIdField="__esri_stream_id__"),(0,re.y)(e,{origin:"service"})})()}};(0,o._)([(0,n.Cb)({type:String})],i.prototype,"copyright",void 0),(0,o._)([(0,n.Cb)({readOnly:!0})],i.prototype,"defaultPopupTemplate",null),(0,o._)([(0,n.Cb)({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],i.prototype,"definitionExpression",void 0),(0,o._)([(0,n.Cb)({type:String})],i.prototype,"displayField",void 0),(0,o._)([(0,n.Cb)({type:ie.Z})],i.prototype,"elevationInfo",void 0),(0,o._)([(0,n.Cb)(j.fields)],i.prototype,"fields",void 0),(0,o._)([(0,n.Cb)(j.fieldsIndex)],i.prototype,"fieldsIndex",void 0),(0,o._)([(0,n.Cb)({type:se.Z})],i.prototype,"geometryDefinition",void 0),(0,o._)([(0,n.Cb)({type:v.M.apiValues,json:{read:{reader:v.M.read}}})],i.prototype,"geometryType",void 0),(0,o._)([(0,n.Cb)(d.iR)],i.prototype,"labelsVisible",void 0),(0,o._)([(0,n.Cb)({type:[_.Z],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:ee.r},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],i.prototype,"labelingInfo",void 0),(0,o._)([(0,n.Cb)(d.rn)],i.prototype,"legendEnabled",void 0),(0,o._)([(0,n.Cb)({type:["show","hide"]})],i.prototype,"listMode",void 0),(0,o._)([(0,n.Cb)({type:S.z8})],i.prototype,"maxReconnectionAttempts",void 0),(0,o._)([(0,n.Cb)({type:S.z8})],i.prototype,"maxReconnectionInterval",void 0),(0,o._)([(0,n.Cb)(d.u1)],i.prototype,"maxScale",void 0),(0,o._)([(0,n.Cb)(d.rO)],i.prototype,"minScale",void 0),(0,o._)([(0,n.Cb)({type:String})],i.prototype,"objectIdField",void 0),(0,o._)([(0,n.Cb)({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],i.prototype,"operationalLayerType",void 0),(0,o._)([(0,n.Cb)(d.C_)],i.prototype,"popupEnabled",void 0),(0,o._)([(0,n.Cb)({type:F.Z,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],i.prototype,"popupTemplate",void 0),(0,o._)([(0,n.Cb)({type:x})],i.prototype,"purgeOptions",void 0),(0,o._)([(0,n.Cb)({types:b.A,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{name:"layerDefinition.drawingInfo.renderer",types:b.o,write:!0}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],i.prototype,"renderer",null),(0,o._)([(0,C.r)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),(0,C.r)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],i.prototype,"readRenderer",null),(0,o._)([(0,n.Cb)(d.YI)],i.prototype,"screenSizePerspectiveEnabled",void 0),(0,o._)([(0,n.Cb)()],i.prototype,"sourceJSON",void 0),(0,o._)([(0,n.Cb)({type:T.Z,json:{origins:{service:{read:{source:"spatialReference"}}}}})],i.prototype,"spatialReference",void 0),(0,o._)([(0,n.Cb)({json:{read:!1}})],i.prototype,"type",void 0),(0,o._)([(0,n.Cb)(d.HQ)],i.prototype,"url",void 0),(0,o._)([(0,n.Cb)({type:Number})],i.prototype,"updateInterval",void 0),(0,o._)([(0,n.Cb)({type:String})],i.prototype,"webSocketUrl",void 0),i=(0,o._)([(0,R.j)("esri.layers.StreamLayer")],i);const u=(0,J.d)({types:D.QT}),ae=i}}]);