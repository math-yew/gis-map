"use strict";(self.webpackChunkarcgis=self.webpackChunkarcgis||[]).push([[5547],{87757:(Q,I,n)=>{n.d(I,{g:()=>p});const p={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},45547:(Q,I,n)=>{n.r(I),n.d(I,{default:()=>oe});var p=n(15861),D=n(17626),M=(n(29132),n(88879)),x=n(24263),m=n(84792),B=n(97478),f=n(26584),S=n(8314),P=n(2076),_=n(47996),y=n(62208),T=n(94113),L=n(10699),E=n(21726),W=n(77712),z=(n(90912),n(85931),n(76898)),w=n(2004),H=n(91179),V=n(47519),X=n(56554),Y=n(57092),k=n(38305),ee=n(20514),te=n(65234);const se=new P.X({originalAndCurrentFeatures:"original-and-current-features",none:"none"});function G(e){return K.apply(this,arguments)}function K(){return(K=(0,p.Z)(function*(e){return"string"==typeof e?(0,E.sJ)(e)||{data:e}:new Promise((s,t)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>s((0,E.sJ)(a.result)),a.onerror=r=>t(r)})})).apply(this,arguments)}const re=new Set(["Feature Layer","Table"]),ae=new P.X({Started:"published",Publishing:"publishing",Stopped:"unavailable"});let v=class extends _.Z{constructor(){var e;super(...arguments),e=this,this.type="feature-layer",this.refresh=(0,L.Ds)((0,p.Z)(function*(){yield e.load();const s=e.sourceJSON.editingInfo?.lastEditDate;if(null==s)return{dataChanged:!0,updates:{}};try{yield e._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const t=s!==e.sourceJSON.editingInfo?.lastEditDate;return{dataChanged:t,updates:t?{editingInfo:e.sourceJSON.editingInfo,extent:e.sourceJSON.extent}:null}}))}load(e){const s=(0,y.pC)(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,s)),Promise.resolve(this)}get queryTask(){const{capabilities:e,parsedUrl:s,dynamicDataSource:t,infoFor3D:a,gdbVersion:r,spatialReference:u,fieldsIndex:l}=this.layer,o=(0,S.Z)("featurelayer-pbf")&&e?.query.supportsFormatPBF&&(0,y.Wi)(a);return new Y.Z({url:s.path,pbfSupported:o,fieldsIndex:l,infoFor3D:a,dynamicDataSource:t,gdbVersion:r,sourceSpatialReference:u,queryAttachmentsSupported:e?.operations?.supportsQueryAttachments??!1})}addAttachment(e,s){var t=this;return(0,p.Z)(function*(){yield t.load();const a=e.attributes[t.layer.objectIdField],r=t.layer.parsedUrl.path+"/"+a+"/addAttachment",u=t._getLayerRequestOptions(),l=t._getFormDataForAttachment(s,u.query);try{const o=yield(0,m.default)(r,{body:l});return t._createFeatureEditResult(o.data.addAttachmentResult)}catch(o){throw t._createAttachmentErrorResult(a,o)}})()}updateAttachment(e,s,t){var a=this;return(0,p.Z)(function*(){yield a.load();const r=e.attributes[a.layer.objectIdField],u=a.layer.parsedUrl.path+"/"+r+"/updateAttachment",l=a._getLayerRequestOptions({query:{attachmentId:s}}),o=a._getFormDataForAttachment(t,l.query);try{const d=yield(0,m.default)(u,{body:o});return a._createFeatureEditResult(d.data.updateAttachmentResult)}catch(d){throw a._createAttachmentErrorResult(r,d)}})()}applyEdits(e,s){var t=this;return(0,p.Z)(function*(){yield t.load();const a=t.layer.infoFor3D,r=(0,y.pC)(a),u=r||(s?.globalIdUsed??!1),l=e.addFeatures?.map(h=>t._serializeFeature(h,a)).filter(y.pC)??[],o=e.updateFeatures?.map(h=>t._serializeFeature(h,a)).filter(y.pC)??[],d=t._getFeatureIds(e.deleteFeatures,u);(0,ee.P)(l,o,t.layer.spatialReference);const c=[],i=[],R=[...e.deleteAttachments??[]];for(const h of e.addAttachments??[])c.push(yield t._serializeAttachment(h));for(const h of e.updateAttachments??[])i.push(yield t._serializeAttachment(h));const A=c.length||i.length||R.length?{adds:c,updates:i,deletes:R}:null;let O,C=null;if(r){C=new Map;const h=[];for(const b of e.addAssets??[])h.push(t._serializeAssetMapEditAndUploadAssets(b,C));const U=yield Promise.all(h);O=U.length?{adds:U,updates:[],deletes:[]}:void 0}const g={gdbVersion:s?.gdbVersion||t.layer.gdbVersion,rollbackOnFailure:s?.rollbackOnFailureEnabled,useGlobalIds:u,returnEditMoment:s?.returnEditMoment,usePreviousEditMoment:s?.usePreviousEditMoment,sessionId:s?.sessionId};s?.returnServiceEditsOption?(g.edits=JSON.stringify([{id:t.layer.layerId,adds:l,updates:o,deletes:d,attachments:A,assetMaps:(0,y.Wg)(O)}]),g.returnServiceEditsOption=se.toJSON(s?.returnServiceEditsOption),g.returnServiceEditsInSourceSR=s?.returnServiceEditsInSourceSR):(g.adds=l.length?JSON.stringify(l):null,g.updates=o.length?JSON.stringify(o):null,g.deletes=d.length?u?JSON.stringify(d):d.join(","):null,g.attachments=A&&JSON.stringify(A),g.assetMaps=(0,y.pC)(O)?JSON.stringify(O):void 0);const ne=t._getLayerRequestOptions({method:"post",query:g}),$=s?.returnServiceEditsOption?t.layer.url:t.layer.parsedUrl.path,j=yield(0,m.default)($+"/applyEdits",ne);if(!t.layer.capabilities.operations?.supportsEditing&&t.layer.effectiveCapabilities?.operations?.supportsEditing&&(yield x.id?.findCredential(t.layer.url)?.refreshToken()),r&&null!=j.data&&null!=j.data.assetMaps){const h=j.data,U=t.layer.objectIdField,b=[];for(const F of h.addResults)F.success&&b.push(F.objectId);for(const F of h.updateResults)F.success&&b.push(F.objectId);const ue=t._createRequestQueryOptions(),q=yield(0,m.default)($+"/query",{...ue,query:{f:"json",formatOf3DObjects:"3D_glb",where:`OBJECTID IN (${b.join(",")})`,outFields:`${U}`}});if(q&&q.data&&q.data.assetMaps&&(0,y.pC)(C)){const F=q.data.assetMaps;for(const N of F){const Z=C.get(N.parentGlobalId).geometry;(0,y.pC)(Z)&&"mesh"===Z.type&&Z.updateExternalSource({source:[{name:N.assetName,source:N.assetName}],extent:Z.extent})}}}return t._createEditsResult(j)})()}deleteAttachments(e,s){var t=this;return(0,p.Z)(function*(){yield t.load();const a=e.attributes[t.layer.objectIdField],r=t.layer.parsedUrl.path+"/"+a+"/deleteAttachments";try{return(yield(0,m.default)(r,t._getLayerRequestOptions({query:{attachmentIds:s.join(",")},method:"post"}))).data.deleteAttachmentResults.map(t._createFeatureEditResult)}catch(u){throw t._createAttachmentErrorResult(a,u)}})()}fetchRecomputedExtents(e={}){var s=this;return this.load({signal:e.signal}).then((0,p.Z)(function*(){const a=s._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:r,url:u}=s.layer,{data:l}=yield(0,m.default)(`${u}/${r}`,a),{id:o,extent:d,fullExtent:c,timeExtent:i}=l,R=d||c;return{id:o,fullExtent:R&&w.Z.fromJSON(R),timeExtent:i&&B.Z.fromJSON({start:i[0],end:i[1]})}}))}queryAttachments(e,s={}){var t=this;return(0,p.Z)(function*(){yield t.load();const a=t._getLayerRequestOptions(s);return t.queryTask.executeAttachmentQuery(e,a)})()}queryFeatures(e,s){var t=this;return(0,p.Z)(function*(){return yield t.load(),t.queryTask.execute(e,{...s,query:t._createRequestQueryOptions(s)})})()}queryFeaturesJSON(e,s){var t=this;return(0,p.Z)(function*(){return yield t.load(),t.queryTask.executeJSON(e,{...s,query:t._createRequestQueryOptions(s)})})()}queryObjectIds(e,s){var t=this;return(0,p.Z)(function*(){return yield t.load(),t.queryTask.executeForIds(e,{...s,query:t._createRequestQueryOptions(s)})})()}queryFeatureCount(e,s){var t=this;return(0,p.Z)(function*(){return yield t.load(),t.queryTask.executeForCount(e,{...s,query:t._createRequestQueryOptions(s)})})()}queryExtent(e,s){var t=this;return(0,p.Z)(function*(){return yield t.load(),t.queryTask.executeForExtent(e,{...s,query:t._createRequestQueryOptions(s)})})()}queryRelatedFeatures(e,s){var t=this;return(0,p.Z)(function*(){return yield t.load(),t.queryTask.executeRelationshipQuery(e,{...s,query:t._createRequestQueryOptions(s)})})()}queryRelatedFeaturesCount(e,s){var t=this;return(0,p.Z)(function*(){return yield t.load(),t.queryTask.executeRelationshipQueryForCount(e,{...s,query:t._createRequestQueryOptions(s)})})()}queryTopFeatures(e,s){var t=this;return(0,p.Z)(function*(){return yield t.load(),t.queryTask.executeTopFeaturesQuery(e,{...s,query:t._createRequestQueryOptions(s)})})()}queryTopObjectIds(e,s){var t=this;return(0,p.Z)(function*(){return yield t.load(),t.queryTask.executeForTopIds(e,{...s,query:t._createRequestQueryOptions(s)})})()}queryTopExtents(e,s){var t=this;return(0,p.Z)(function*(){return yield t.load(),t.queryTask.executeForTopExtents(e,{...s,query:t._createRequestQueryOptions(s)})})()}queryTopCount(e,s){var t=this;return(0,p.Z)(function*(){return yield t.load(),t.queryTask.executeForTopCount(e,{...s,query:t._createRequestQueryOptions(s)})})()}fetchPublishingStatus(){var e=this;return(0,p.Z)(function*(){if(!(0,k.M8)(e.layer.url))return"unavailable";const s=(0,E.v_)(e.layer.url,"status"),t=yield(0,m.default)(s,{query:{f:"json"}});return ae.fromJSON(t.data.status)})()}_createRequestQueryOptions(e){const s={...this.layer.customParameters,token:this.layer.apiKey,...e?.query};return this.layer.datesInUnknownTimezone&&(s.timeReferenceUnknownClient=!0),s}_fetchService(e,s){var t=this;return(0,p.Z)(function*(){if(!e){const{data:r}=yield(0,m.default)(t.layer.parsedUrl.path,t._getLayerRequestOptions({query:(0,S.Z)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:s}));e=r}t.sourceJSON=t._patchServiceJSON(e);const a=e.type;if(!re.has(a))throw new f.Z("feature-layer-source:unsupported-type",`Source type "${a}" is not supported`)})()}_patchServiceJSON(e){if("Table"!==e.type&&e.geometryType&&!e?.drawingInfo?.renderer&&!e.defaultSymbol){const s=(0,X.bU)(e.geometryType).renderer;(0,T.RB)("drawingInfo.renderer",s,e)}return"esriGeometryMultiPatch"===e.geometryType&&e.infoFor3D&&(e.geometryType="mesh"),e}_serializeFeature(e,s){const{geometry:t,attributes:a}=e;if((0,y.pC)(s)&&(0,y.pC)(e.geometry)&&"mesh"===e.geometry.type){const r={...a},u=e.geometry,l=u.origin,o=u.transform;if(r[s.transformFieldRoles.originX]=l.x,r[s.transformFieldRoles.originY]=l.y,r[s.transformFieldRoles.originZ]=l.z,(0,y.pC)(o)){const d=o.translation,c=o.scale,i=o.rotation;r[s.transformFieldRoles.translationX]=d[0],r[s.transformFieldRoles.translationY]=-d[2],r[s.transformFieldRoles.translationZ]=d[1],r[s.transformFieldRoles.scaleX]=c[0],r[s.transformFieldRoles.scaleY]=c[1],r[s.transformFieldRoles.scaleZ]=c[2],r[s.transformFieldRoles.rotationX]=i[0],r[s.transformFieldRoles.rotationY]=i[2],r[s.transformFieldRoles.rotationZ]=i[1],r[s.transformFieldRoles.rotationDeg]=i[3]}return{geometry:null,attributes:r}}return(0,y.Wi)(t)?{attributes:a}:"mesh"===t.type||"extent"===t.type?null:{geometry:t.toJSON(),attributes:a}}_serializeAttachment(e){var s=this;return(0,p.Z)(function*(){const{feature:t,attachment:a}=e,{globalId:r,name:u,contentType:l,data:o,uploadId:d}=a,c={globalId:r,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(c.parentGlobalId="attributes"in t?t.attributes&&t.attributes[s.layer.globalIdField]:t.globalId),d)c.uploadId=d;else if(o){const i=yield G(o);i&&(c.contentType=i.mediaType,c.data=i.data),o instanceof File&&(c.name=o.name)}return u&&(c.name=u),l&&(c.contentType=l),c})()}_serializeAssetMapEditAndUploadAssets(e,s){var t=this;return(0,p.Z)(function*(){const a=t.layer.url;let r=null;try{const i=new Blob([e.data],{type:e.mimeType}),R=new FormData;R.append("f","json"),R.append("file",i,`${e.assetName}`);const A={body:R,method:"post",responseType:"json"},{data:O}=yield(0,m.default)(`${a}/uploads/upload`,A);if(!O.success)throw new f.Z("feature-layer-source:upload-failure","Expected upload to be successfull.");r={assetType:e.assetType,assetUploadId:O.item.itemID}}catch{r=null}if((0,y.Wi)(r)){const i=yield G(new Blob([e.data]));if(!i.isBase64)throw new f.Z("feature-layer-source:uploadAssets-failure","Expected gltf data in base64 format after conversion.");r={assetType:e.assetType,assetData:i.data}}if((0,y.Wi)(r))throw new f.Z("feature-layer-source:uploadAssets-failure","Unable to prepare uploadAsset request options.");const u={method:"post",query:{f:"json",assets:JSON.stringify([r])},responseType:"json"},l=yield(0,m.default)((0,E.v_)(t.layer.parsedUrl.path,"uploadAssets"),u);if(1!==l.data.uploadResults.length||!l.data.uploadResults[0].success)throw new f.Z("feature-layer-source:uploadAssets-failure","Bad response.");const o=l.data.uploadResults[0].assetHash,d=[];e.flags&V.i.PROJECT_VERTICES&&d.push("PROJECT_VERTICES");const c={globalId:e.assetMapGlobalId,parentGlobalId:e.featureGlobalId,assetName:e.assetName,assetHash:o,flags:d};return s.set(e.featureGlobalId,e.feature),c})()}_getFeatureIds(e,s){const t=e?.[0];return t?this._canUseGlobalIds(s,e)?this._getGlobalIdsFromFeatureIdentifier(e):"objectId"in t?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const s=this.layer.objectIdField;return e.map(t=>t.attributes&&t.attributes[s])}_canUseGlobalIds(e,s){return e&&"globalId"in s[0]}_getObjectIdsFromFeatureIdentifier(e){return e.map(s=>s.objectId)}_getGlobalIdsFromFeatureIdentifier(e){return e.map(s=>s.globalId)}_createEditsResult(e){const s=e.data,{layerId:t}=this.layer,a=[];let r=null;if(Array.isArray(s))for(const o of s)a.push({id:o.id,editedFeatures:o.editedFeatures}),o.id===t&&(r={addResults:o.addResults??[],updateResults:o.updateResults??[],deleteResults:o.deleteResults??[],attachments:o.attachments,editMoment:o.editMoment});else r=s;const u=r?.attachments,l={addFeatureResults:r?.addResults?.map(this._createFeatureEditResult,this)??[],updateFeatureResults:r?.updateResults?.map(this._createFeatureEditResult,this)??[],deleteFeatureResults:r?.deleteResults?.map(this._createFeatureEditResult,this)??[],addAttachmentResults:u&&u.addResults?u.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:u&&u.updateResults?u.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:u&&u.deleteResults?u.deleteResults.map(this._createFeatureEditResult,this):[]};if(r?.editMoment&&(l.editMoment=r.editMoment),a.length>0){l.editedFeatureResults=[];for(const o of a){const{editedFeatures:d}=o,c=d?.spatialReference?new te.Z(d.spatialReference):null;l.editedFeatureResults.push({layerId:o.id,editedFeatures:{adds:d?.adds?.map(i=>this._createEditedFeature(i,c))||[],updates:d?.updates?.map(i=>({original:this._createEditedFeature(i[0],c),current:this._createEditedFeature(i[1],c)}))||[],deletes:d?.deletes?.map(i=>this._createEditedFeature(i,c))||[],spatialReference:c}})}}return l}_createEditedFeature(e,s){return new M.Z({attributes:e.attributes,geometry:(0,H.im)({...e.geometry,spatialReference:s})})}_createFeatureEditResult(e){const s=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:s?new f.Z("feature-layer-source:edit-failure",s.description,{code:s.code}):null}}_createAttachmentErrorResult(e,s){return{objectId:e,globalId:null,error:new f.Z("feature-layer-source:attachment-failure",s.details.messages&&s.details.messages[0]||s.message,{code:s.details.httpStatus||s.details.messageCode})}}_getFormDataForAttachment(e,s){const t=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(t)for(const a in s){const r=s[a];null!=r&&(t.set?t.set(a,r):t.append(a,r))}return t}_getLayerRequestOptions(e={}){const{parsedUrl:s,gdbVersion:t,dynamicDataSource:a}=this.layer;return{...e,query:{gdbVersion:t,layer:a?JSON.stringify({source:a}):void 0,...s.query,f:"json",...this._createRequestQueryOptions(e)},responseType:"json"}}};(0,D._)([(0,W.Cb)()],v.prototype,"type",void 0),(0,D._)([(0,W.Cb)({constructOnly:!0})],v.prototype,"layer",void 0),(0,D._)([(0,W.Cb)({readOnly:!0})],v.prototype,"queryTask",null),v=(0,D._)([(0,z.j)("esri.layers.graphics.sources.FeatureLayerSource")],v);const oe=v},56554:(Q,I,n)=>{n.d(I,{Dm:()=>f,Hq:()=>S,MS:()=>P,bU:()=>x});var p=n(8314),D=n(58817),J=n(87757),M=n(24837);function x(_){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===_||"esriGeometryMultipoint"===_?M.I4:"esriGeometryPolyline"===_?M.ET:M.lF}}}const m=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let B=1;function f(_,y){if((0,p.Z)("esri-csp-restrictions"))return()=>({[y]:null,..._});try{let T=`this.${y} = null;`;for(const E in _)T+=`this${m.test(E)?`.${E}`:`["${E}"]`} = ${JSON.stringify(_[E])};`;const L=new Function(`\n      return class AttributesClass$${B++} {\n        constructor() {\n          ${T};\n        }\n      }\n    `)();return()=>new L}catch{return()=>({[y]:null,..._})}}function S(_={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,D.d9)(_)}}]}function P(_,y){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:_},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:y,supportsDelete:y,supportsEditing:y,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:y,supportsExceedsLimitStatistics:!0},query:J.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:y,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}}}]);