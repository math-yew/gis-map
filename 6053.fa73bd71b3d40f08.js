"use strict";(self.webpackChunkarcgis=self.webpackChunkarcgis||[]).push([[6053],{6053:(Z,c,t)=>{t.r(c),t.d(c,{default:()=>z});var y=t(15861),s=t(17626),f=t(63290),g=t(62208),C=t(10699),U=t(32917),n=t(77712),u=(t(90912),t(85931),t(76898)),d=t(2004),v=t(91757),x=t(37384),A=t(67802),B=t(45611),F=t(94421),M=t(26584),w=t(13812),K=t(51920);const b=r=>{let e=class extends r{initialize(){this.exportImageParameters=new K.j({layer:this.layer})}destroy(){this.exportImageParameters=(0,g.SC)(this.exportImageParameters)}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}fetchPopupFeatures(o){const{layer:i}=this;if(!o)return Promise.reject(new M.Z("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i}));const{popupEnabled:p}=i;if(!p)return Promise.reject(new M.Z("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:p}));const E=this.createFetchPopupFeaturesQuery(o);if(!E)return Promise.resolve([]);const{extent:a,width:h,height:l,x:P,y:I}=E;if(!(a&&h&&l))throw new M.Z("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:a,width:h,height:l});return i.fetchFeatureInfo(a,h,l,P,I)}};return(0,s._)([(0,n.Cb)()],e.prototype,"exportImageParameters",void 0),(0,s._)([(0,n.Cb)({readOnly:!0})],e.prototype,"exportImageVersion",null),(0,s._)([(0,n.Cb)()],e.prototype,"layer",void 0),(0,s._)([(0,n.Cb)(w.qG)],e.prototype,"timeExtent",void 0),e=(0,s._)([(0,u.j)("esri.layers.mixins.WMSLayerView")],e),e};let m=class extends(b((0,F.Z)((0,x.y)(B.Z)))){constructor(){super(...arguments),this.bitmapContainer=new v.c}supportsSpatialReference(r){return this.layer.serviceSupportsSpatialReference(r)}update(r){this.strategy.update(r).catch(e=>{(0,C.D_)(e)||f.Z.getLogger(this.declaredClass).error(e)})}attach(){const{layer:r}=this,{imageMaxHeight:e,imageMaxWidth:o}=r;this.bitmapContainer=new v.c,this.container.addChild(this.bitmapContainer),this.strategy=new A.Z({container:this.bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:e,imageMaxWidth:o,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.addAttachHandles((0,U.YP)(()=>this.exportImageVersion,()=>this.requestUpdate()))}detach(){this.strategy=(0,g.SC)(this.strategy),this.container.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(r){const{view:e,bitmapContainer:o}=this,{x:i,y:p}=r,{spatialReference:E}=e;let a,h=0,l=0;if(o.children.some(G=>{const{width:S,height:j,resolution:W,x:D,y:L}=G,T=D+W*S,V=L-W*j;return i>=D&&i<=T&&p<=L&&p>=V&&(a=new d.Z({xmin:D,ymin:V,xmax:T,ymax:L,spatialReference:E}),h=S,l=j,!0)}),!a)return null;const P=a.width/h,I=Math.round((i-a.xmin)/P),H=Math.round((a.ymax-p)/P);return{extent:a,width:h,height:l,x:I,y:H}}doRefresh(){var r=this;return(0,y.Z)(function*(){r.requestUpdate()})()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(r,e,o,i){return this.layer.fetchImageBitmap(r,e,o,{timeExtent:this.timeExtent,...i})}};(0,s._)([(0,n.Cb)()],m.prototype,"strategy",void 0),(0,s._)([(0,n.Cb)()],m.prototype,"updating",void 0),m=(0,s._)([(0,u.j)("esri.views.2d.layers.WMSLayerView2D")],m);const z=m},94421:(Z,c,t)=>{t.d(c,{Z:()=>O});var y=t(17626),s=t(63290),f=t(10699),g=t(32917),C=t(77712),R=(t(90912),t(85931),t(76898));const O=u=>{let d=class extends u{initialize(){this.handles.add((0,g.on)(()=>this.layer,"refresh",v=>{this.doRefresh(v.dataChanged).catch(x=>{(0,f.D_)(x)||s.Z.getLogger(this.declaredClass).error(x)})}),"RefreshableLayerView")}};return(0,y._)([(0,C.Cb)()],d.prototype,"layer",void 0),d=(0,y._)([(0,R.j)("esri.layers.mixins.RefreshableLayerView")],d),d}}}]);